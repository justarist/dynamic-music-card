<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Music Card</title>
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.12);
            --accent: #00d2ff;
            --accent-purple: #9d50bb;
            --text: #e0e0e0;
            --plt-spotify: #1DB954;
            --plt-yandex: #fed42b;
            --plt-apple: #fc3c44;
            --plt-youtube: #ff0033;
            --plt-soundcloud: #ff5500;
        }

        ::selection {
            background: var(--dynamic-color, var(--accent));
            color: #000;
        }

        ::-moz-selection {
            background: var(--dynamic-color, var(--accent));
            color: #000;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: #05070a;
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            padding: 40px 20px;
            transition: background 0.5s ease;
        }

        .bg-blobs {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            filter: blur(80px);
            opacity: 0.5;
        }

        .blob {
            position: absolute;
            border-radius: 50%;
            transition: all 1s ease;
            animation: move 20s infinite alternate;
        }

        .blob-1 { width: 400px; height: 400px; background: var(--accent); top: -10%; left: -10%; }
        .blob-2 { width: 500px; height: 500px; background: var(--accent-purple); bottom: -10%; right: -5%; animation-duration: 25s; }
        .blob-3 { width: 300px; height: 300px; background: #3a1c71; top: 40%; left: 30%; animation-duration: 15s; }

        @keyframes move {
            from { transform: translate(0, 0) scale(1); }
            to { transform: translate(100px, 50px) scale(1.2); }
        }

        .container {
            max-width: 700px;
            width: 100%;
            z-index: 1;
        }

        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.6);
        }

        header { text-align: center; margin-bottom: 30px; }
        h1 {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, #888 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .input-group label {
            display: block;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 12px;
            color: #888;
        }

        input[type="text"] {
            width: 100%;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--glass-border);
            border-radius: 14px;
            color: #fff;
            font-size: 1rem;
            outline: none;
            transition: 0.3s;
        }

        input[type="text"]:focus {
            border-color: var(--dynamic-color, var(--accent));
            box-shadow: 0 0 20px rgba(var(--dynamic-rgb, 0, 210, 255), 0.2);
        }

        .radio-group {
            display: flex;
            gap: 12px;
            margin: 25px 0;
        }

        .radio-option { flex: 1; cursor: pointer; }
        .radio-option input { display: none; }
        .radio-option span {
            display: block;
            padding: 12px;
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            text-align: center;
            font-size: 0.9rem;
            transition: 0.3s;
        }

        .radio-option input:checked + span {
            background: var(--dynamic-color, var(--accent));
            color: #000;
            font-weight: 600;
        }

        button.main-btn {
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            border: none;
            background: var(--dynamic-color, linear-gradient(135deg, var(--accent), var(--accent-purple)));
            color: #fff;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
        }

        button.main-btn:hover {
            filter: brightness(1.2);
            box-shadow: 0 10px 30px rgba(var(--dynamic-rgb, 0,0,0), 0.3);
        }

        .platforms-footer {
            margin-top: 30px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .plt-tag {
            font-size: 0.75rem;
            padding: 6px 14px;
            border-radius: 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            color: #666;
            transition: 0.3s;
        }

        .plt-tag.active {
            color: #fff;
            border-color: var(--plt-color);
            background: rgba(var(--plt-rgb), 0.15);
            box-shadow: 0 0 10px rgba(var(--plt-rgb), 0.2);
        }

        .preview-area { margin-top: 30px; text-align: center; }
        #previewImg { max-width: 100%; border-radius: 16px; display: none; margin: 0 auto; }

        .code-box {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            border: 1px solid var(--glass-border);
            position: relative;
            text-align: left;
            overflow-x: hidden;
        }

        .code-box code {
            font-family: 'Fira Code', monospace;
            padding-right: 60px;
            font-size: 0.8rem;
            color: #fff;
            white-space: pre-wrap; 
            word-break: break-all;
            display: block;
        }

        .copy-btn {
            position: absolute;
            right: 8px; 
            top: 8px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            color: #fff;
            padding: 6px 10px; 
            border-radius: 8px; 
            cursor: pointer;
            font-size: 0.7rem;
            font-weight: 600;
            transition: all 0.2s ease;
            z-index: 2;
        }

        .copy-btn:hover {
            background: var(--dynamic-color, var(--accent));
            color: #000;
            border-color: transparent;
            transform: translateY(-1px);
        }

        .copy-btn:active {
            transform: translateY(0);
        }

        .external-links {
            margin-top: 40px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .ext-link {
            color: #888;
            text-decoration: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
            padding: 10px 20px;
            background: var(--glass-bg);
            border-radius: 12px;
            border: 1px solid var(--glass-border);
        }

        .ext-link:hover { color: #fff; background: rgba(255,255,255,0.08); }

        .loader {
            width: 30px; height: 30px;
            border: 2px solid rgba(255,255,255,0.1);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none; margin: 20px auto;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .theme-selector {
            display: flex;
            gap: 10px;
        }
        .theme-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            color: #888;
            cursor: pointer;
            transition: 0.3s;
            font-size: 0.8rem;
        }
        .theme-btn.active {
            border-color: var(--dynamic-color, var(--accent));
            color: #fff;
            background: rgba(var(--dynamic-rgb, 0, 210, 255), 0.1);
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 34px;
            height: 20px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(255,255,255,0.1);
            transition: .4s;
            border-radius: 34px;
            border: 1px solid var(--glass-border);
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 12px; width: 12px;
            left: 3px; bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--dynamic-color, var(--accent)); }
        input:checked + .slider:before { transform: translateX(14px); }
        ::-webkit-scrollbar { width: 12px; height: 12px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); border-radius: 10px; }
        ::-webkit-scrollbar-thumb {
            background-color: rgba(var(--dynamic-rgb, 0, 210, 255), 0.8); 
            border-radius: 10px;
            border: 4px solid transparent;
            background-clip: content-box;
            transition: background-color 0.3s ease;
        }
        ::-webkit-scrollbar-thumb:hover { background-color: var(--dynamic-color, var(--accent)); }
        #results label {
            display: block;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            margin-top: 25px;
            margin-bottom: 8px;
            color: #888;
            text-align: left;
        }

        .hl-tag { color: var(--dynamic-color, var(--accent)); }
        .hl-attr { color: #fff; opacity: 0.8; }
        .hl-str { color: var(--accent-purple); }
        .hl-md-bracket { color: var(--dynamic-color, var(--accent)); }
    </style>
</head>
<body>

    <div class="bg-blobs">
        <div class="blob blob-1" id="b1"></div>
        <div class="blob blob-2" id="b2"></div>
        <div class="blob blob-3" id="b3"></div>
    </div>

    <div class="container">
        <div class="glass-panel">
            <header>
                <h1>Dynamic Music Card</h1>
                <p style="color: #888; font-size: 0.85rem;">Dynamic SVG widgets generator for your GitHub README</p>
            </header>

            <div class="input-group">
                <label>Music URL</label>
                <input type="text" id="linkInput" oninput="detectPlatform()" placeholder="Paste link here...">
            </div>

            <div class="radio-group">
                <label class="radio-option"><input type="radio" name="type" value="track" checked><span>Track</span></label>
                <label class="radio-option"><input type="radio" name="type" value="artist"><span>Artist</span></label>
                <label class="radio-option"><input type="radio" name="type" value="album"><span>Album</span></label>
            </div>

            <div class="input-group" style="margin-top: 20px;">
                <label>Select Theme</label>
                <div class="theme-selector" id="themeSelector">
                    <button class="theme-btn active" onclick="selectTheme(this, 'plastic')">Plastic</button>
                    <button class="theme-btn" onclick="selectTheme(this, 'glass')">Glass</button>
                    <button class="theme-btn" onclick="selectTheme(this, 'retro')">Retro</button>
                </div>
            </div>

            <div style="margin: 20px 0; display: flex; align-items: center; gap: 10px;">
                <label class="switch">
                    <input type="checkbox" id="cacheBust">
                    <span class="slider"></span>
                </label>
                <span style="font-size: 0.85rem; color: #aaa;">Enable Cache Bust (No cache)</span>
            </div>

            <button class="main-btn" onclick="generateCard()">Generate Card</button>

            <div class="platforms-footer">
                <span class="plt-tag" id="tag-youtube" style="--plt-color: var(--plt-youtube); --plt-rgb: 255, 0, 51;">YouTube Music</span>
                <span class="plt-tag" id="tag-spotify" style="--plt-color: var(--plt-spotify); --plt-rgb: 29, 185, 84;">Spotify</span>
                <span class="plt-tag" id="tag-yandex" style="--plt-color: var(--plt-yandex); --plt-rgb: 254, 212, 43;">Yandex Music</span>
                <span class="plt-tag" id="tag-apple" style="--plt-color: var(--plt-apple); --plt-rgb: 252, 60, 68;">Apple Music</span>
                <span class="plt-tag" id="tag-soundcloud" style="--plt-color: var(--plt-soundcloud); --plt-rgb: 255, 85, 0;">SoundCloud</span>
            </div>

            <div class="preview-area">
                <div class="loader" id="loader"></div>
                <img id="previewImg" src="" alt="Preview">
                
                <div id="results" style="display: none;">
                    <label>Markdown Code</label>
                    <div class="code-box">
                        <code id="mdCode"></code>
                        <button class="copy-btn" onclick="copyText('mdCode')">Copy</button>
                    </div>
                    <label>HTML Code (no referrer)</label>
                    <div class="code-box">
                        <code id="htmlCodeNoReferrer"></code>
                        <button class="copy-btn" onclick="copyText('htmlCodeNoReferrer')">Copy</button>
                    </div>
                    <label>HTML Code (with referrer)</label>
                    <div class="code-box">
                        <code id="htmlCodeReferrer"></code>
                        <button class="copy-btn" onclick="copyText('htmlCodeReferrer')">Copy</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="external-links">
            <a href="https://github.com/justarist/dynamic-music-card" target="_blank" class="ext-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 21.795 24 17.298 24 12c0-6.627-5.373-12-12-12"/></svg>
                GitHub
            </a>
            <a href="https://github.com/justarist" target="_blank" class="ext-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                Profile
            </a>
        </div>
    </div>

    <script>
        const DOMAIN = "https://dynamic-music-card.vercel.app";
        
        const platforms = {
            youtube: { color: '#ff0033', rgb: '255, 0, 51' },
            spotify: { color: '#1DB954', rgb: '29, 185, 84' },
            yandex: { color: '#fed42b', rgb: '254, 212, 43' },
            apple: { color: '#fc3c44', rgb: '252, 60, 68' },
            soundcloud: { color: '#ff5500', rgb: '255, 85, 0' }
        };

        const typeKeywords = {
            track: ['track', 'watch', 'song', 'playback'],
            artist: ['artist', 'author', 'composer'],
            album: ['album', 'playlist', 'sets']
        };

        let currentTheme = 'default';

        function selectTheme(btn, theme) {
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentTheme = theme;
        }

        function detectPlatform() {
            const val = document.getElementById('linkInput').value.toLowerCase();
            let detected = null;

            Object.keys(platforms).forEach(p => {
                const tag = document.getElementById(`tag-${p}`);
                if (val.includes(p)) {
                    detected = p;
                    tag.classList.add('active');
                } else {
                    tag.classList.remove('active');
                }
            });

            const root = document.documentElement;
            if (detected) {
                const p = platforms[detected];
                root.style.setProperty('--dynamic-color', p.color);
                root.style.setProperty('--dynamic-rgb', p.rgb);
                document.getElementById('b1').style.background = p.color;
            } else {
                root.style.removeProperty('--dynamic-color');
                root.style.removeProperty('--dynamic-rgb');
                document.getElementById('b1').style.background = '#00d2ff';
            }

            for (const [type, keywords] of Object.entries(typeKeywords)) {
                if (keywords.some(kw => val.includes(kw))) {
                    const radio = document.querySelector(`input[name="type"][value="${type}"]`);
                    if (radio) {
                        radio.checked = true;
                        break;
                    }
                }
            }
        }

        function applyHighlight(text, type) {
            if (type === 'html') {
                let res = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                
                return res.replace(/(&lt;\/?[a-z1-6]+|&gt;)|(\s[a-z-]+(?==))|("(.*?)")/gi, (match, tag, attr, str) => {
                    if (tag) return `<span class="hl-tag">${tag}</span>`;
                    if (attr) return ` <span class="hl-attr">${attr.trim()}</span>`;
                    if (str) return `<span class="hl-str">${str}</span>`;
                    return match;
                });
            } else {
                return text
                    .replace(/(!\[|\]\(|\))/g, '<span class="hl-tag">$1</span>')
                    .replace(/\[(.*?)\]/g, '[<span class="hl-attr">$1</span>]')
                    .replace(/\((.*?)\)/g, '(<span class="hl-str">$1</span>)');
            }
        }

        function generateCard() {
            const link = document.getElementById('linkInput').value.trim();
            const type = document.querySelector('input[name="type"]:checked').value;
            const img = document.getElementById('previewImg');
            const loader = document.getElementById('loader');
            const res = document.getElementById('results');

            if (!link) return;

            loader.style.display = 'block';
            img.style.display = 'none';
            res.style.display = 'none';

            let apiUrl = `${DOMAIN}/api/${type}?link=${encodeURIComponent(link)}`;

            apiUrl += `&theme=${currentTheme}`;

            if (document.getElementById('cacheBust').checked) apiUrl += `&cache_bust=1`;
            
            img.onload = () => {
                loader.style.display = 'none';
                img.style.display = 'block';
                res.style.display = 'block';
                
                const mdRaw = `![Music](${apiUrl})`;
                const htmlNoRefRaw = `<img src="${apiUrl}" alt="Music">`;
                const htmlRefRaw = `<a href="${link}"><img src="${apiUrl}" alt="Music"></a>`;

                document.getElementById('mdCode').innerHTML = applyHighlight(mdRaw, 'md');
                document.getElementById('htmlCodeNoReferrer').innerHTML = applyHighlight(htmlNoRefRaw, 'html');
                document.getElementById('htmlCodeReferrer').innerHTML = applyHighlight(htmlRefRaw, 'html');
            };
            img.src = apiUrl + "&t=" + Date.now();
        }

        function copyText(id) {
            const text = document.getElementById(id).innerText;
            navigator.clipboard.writeText(text);
            
            const btn = event.currentTarget;
            const originalText = btn.innerText;
            btn.innerText = "Copied!";
            btn.style.background = "var(--dynamic-color, var(--accent))";
            btn.style.color = "#000";
            
            setTimeout(() => {
                btn.innerText = originalText;
                btn.style.background = "";
                btn.style.color = "";
            }, 2000);
        }

        detectPlatform();
        window.onload = generateCard;
    </script>
</body>
</html>
